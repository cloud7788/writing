# The Fastest Way to Clone Javascript Arrays

배열(Array)은 많은 수의 데이터를 반복적으로 다루기에 편리한 개념으로 많은 개발 언어에서 사용가능한 기능이다. 이 글에서는 자바스크립트의 배열을 복제(deep clone)하기 위해서 어떤 방법이 있는지 알아보고, 가장 빠르고 효율적인 자바스크립트 배열 복제방법에 대해 이야기하고자 한다.

## 1. 자바스크립트의 배열
자바스크립트의 배열은 레퍼런스 객체이다. 배열 변수의 대입은 배열의 원소가 저장되어 있는 메모리의 주소값에 대한 정보만을 복사한 것으로 배열 안에 있는 실제 값의 복제가 이루어지지는 않는다. 자바스크립트의 배열을 복제하는 방법에는 아래와 같이 크게 두 가지 방법이 있다.

* 자바스크립트 내장함수를 이용하는 방법
* 새로운 배열을 선언하고, 원본 배열의 모든 원소를 순회하며 새로 생성한 배열에 값을 삽입하는 방법

이어서 위 두 가지 방법의 자세한 구현 방법과 성능에 대해 이야기 해 보자.

## 2. 내장함수를 이용한 배열의 복사

자바스크립트의 내장함수 중에는(ES5 기준으로) 배열의 복사를 위한 함수가 존재하지는 않는다. 하지만, 일부 내장함수의 경우 출력되는 결과 값을 입력 파라메터와 다른 위치의 메모리에 값을 할당하여 반환하는 명령이 존재한다. 따라서 이러한 내장함수의 동작을 배열의 복제에 이용 할 수 있을 것이다.

### 2.1 Array.slice
Array객체의 prototype 함수인 slice는 본래 원본배열에서 원하는 갯수 만큼 원소를 잘라내는 기능을 제공한다. 그런데 원본 배열을 잘라 낼 위치를 배열의 시작지점으로 주면, 원본배열의 시작부터 끝까지를 잘라낸 값이라 판단하여 별도의 메모리 영역에 배열의 모든 값을 복제한 다음 이렇게 복제한 배열을 반환하게 된다. 이는 우리가 구현하고자 하는 배열의 깊은 복제에 해당하며, 많은 라이브러리에서 배열의 복제를 위해 이 방법을 이용하고 있다.

slice함수를 이용한 배열의 복제는 다음과 같이 파라메터를 주지 않거나, 0을 파라메터로 하여 함수를 호출하면 된다.
```javascript
var origin = [1,2,3,4];
var clone1 = origin.slice();
var clone2 = origin.slice(0);
```

### 2.2 Array.concat
Array객체의 prototype 함수인 concat은 원본 배열에 파라메터로 받은 배열을 붙여서 하나의 새로운 배열을 생성하는 기능을 제공한다. 이 때, 파라메터로 빈 배열객체를 전달하면 원본배열에 빈 배열을 합쳐서 원본배열과 같은데이터를 가진 새로운 객체를 반환하게 된다.

concat 함수를 이용한 배열의 복제는 다음과 같이 할 수 있다.
```javascript
var origin = [1,2,3,4];
var clone = origin.concat([]);
```

### 2.3 Serialize
자바스크립트의 객체(JSON)를 다른 시스템으로 전송하기 위해 자바스크립트의 내장함수를 이용하여 문자열로 직렬화(Serialize) 하는 기능을 사용 할 수 있다. 이렇게 직렬화한 객체를 다시 파싱하면 원본과 동일한 값을 가진 객체로 생성 할 수 있어 객체의 복사에 활용 할 수 도 있다.

```javascript
var origin = [1,2,3,4];
var clone = JSON.parse( JSON.stringify(origin) );
```

### 2.4 내장함수를 이용한 객체복사 성능 비교
앞서 소개한 자바스크립트의 내장함수를 이용한 방법으로 배열을 복사할 때의 성능을 비교 해 보았다. 복사할 원본 배열은 크기는 1,000,000개의 정수가 저장되어 있는 배열이며, 각각의 방법마다 10회씩 복사를 수행하여 평균적으로 소요되는 시간을 구했다.

```
copySlice : 4.2ms
copySliceZero : 6.4ms
copyConcat : 4.9ms
copyJSON : 52.8ms
```

테스트 결과 JSON 문자열로 변환한 후 다시 객체로 파싱하는 방법이 가장 성능이 떨어졌으며, 파라메터 없이 slice 함수 호출로 객체를 복사하는 방법이 가장 빠르게 동작함을 볼 수 있다.

## 3. 배열을 순회와 배열 값 삽입
배열을 순회하면서 값을 삽입하는 방법은 공통적으로 빈 배열 객체를 생성하고, 이 배열 객체의 각각의 위치에 원본 배열의 값을 일일히 대입하는 과정을 거친다.

이 때, 동작 속도에 영향을 줄 수 있는 부분은 배열의 선언방법, 반복문을 이용한 배열의 순회방법, 배열에 값을 추가하는 방법을 들 수 있다.

### 3.1 배열의 생성 방법
자바스크립트의 배열 생성방법은, Array 객체의 생성자를 명시적으로 호출하는 방법과 리터럴(Literal) 방식으로 배열을 선언하는 방법을 들 수 있다.

Array객체를 이용하는 방법은 new 키워드를 이용하여 Array객체의 생성자를 명시적으로 호출하는 방법이며, 이때 파라메터로 배열의 크기를 지정하거나 초기 배열의 원소를 입력 할 수 있다. 리터럴 방식을 이용한 배열의 선언은 배열의 선언과 동시에 값을 바로 할당 할 수 있도록 배열의 원소를 포함하는 값의 목록을 ```[]```으로 감싸서 표현하는 방식이다. 일반적으로 배열의 생성은 성능 및 객체의 프로토타입 활용측면에서 리터럴 방식을 사용하는것을 추천하며, 이와 관련된 이야기는[여기 링크의 글](http://stackoverflow.com/questions/885156/whats-wrong-with-var-x-new-array)을 참고 하도록 하자.

```javascript
// Using constructor of Array object
var arr1 = new Array (3);
var arr2 = new Array (1,2,3);

// Using literal way
var arr3 = [1,2,3];
```

위의 예와 같이 자바스크립트의 배열을 생성 할 수 있다. 이 때 arr1은 배열의 크기만을 가진 ```[undefined, undefined, undefined]```의 값을 가진 배열을 생성하며, arr2와 arr3는 파라메터로 주어진 값을 배열의 원소로 구성하여 ```[1,2,3]```의 값으로 초리과된 배열 객체를 생성하게 된다.

### 3.2 반복문을 이용한 배열의 순회 방법
반복문을 이용하여 배열의 모든 값을 순회하는 방법은 여러가지가 있지만, 여기에서는 다음 4가지 방법을 소개 하고자 한다.

* for 구문과 배열의 인덱스를 이용한 순차 접근
* while 구문과 배열의 인덱스를 이용한 순차 접근
* for-in 구문을 이용한 인덱스 획득 및 원소 조회
* Array 객체의 프로토타입 함수인 forEach 함수를 이용한 배열 순회

위에 열거한 각각의 방법에 대해 ```[1,2,3,4]```의 값을 가진 배열의 모든 원소를 출력하는 예제는 다음과 같다.

```javasceipt
var arr = [1,2,3,4];

// for 구문과 배열의 인덱스를 이용한 순차 접근
var inx = 0;
for(inx = 0 ; inx < arr.length ; inx++ ){
    console.log(arr[inx]);
}

// while 구문과 배열의 인덱스를 이용한 순차 접근
var inx = arr.length;
while(inx--){
    console.log(arr[inx]);
}

// for-in 구문을 이용한 인덱스 획득 및 원소 조회
var inx = 0;
for(inx in arr){
    console.log(arr[inx]);
}

// Array 객체의 프로토타입 함수인 forEach 함수를 이용한 배열 순회
arr.forEach(function(element, inx){
    console.log(element);
});
```

## 4. 결론

## 참고
* The way to create Javascript arrays : http://stackoverflow.com/questions/885156/whats-wrong-with-var-x-new-array